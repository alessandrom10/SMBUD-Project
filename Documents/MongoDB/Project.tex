% A LaTeX template for MSc Thesis submissions to 
% Politecnico di Milano (PoliMi) - School of Industrial and Information Engineering
%
% S. Bonetti, A. Gruttadauria, G. Mescolini, A. Zingaro
% e-mail: template-tesi-ingind@polimi.it
%
% Last Revision: October 2021
%
% Copyright 2021 Politecnico di Milano, Italy. NC-BY

\documentclass{Configuration_Files/PoliMi3i_thesis}

%------------------------------------------------------------------------------
%	REQUIRED PACKAGES AND  CONFIGURATIONS
%------------------------------------------------------------------------------

% CONFIGURATIONS
\usepackage{parskip} % For paragraph layout
\usepackage{setspace} % For using single or double spacing
\usepackage{emptypage} % To insert empty pages
\usepackage{multicol} % To write in multiple columns (executive summary)
\setlength\columnsep{15pt} % Column separation in executive summary
\setlength\parindent{0pt} % Indentation
\raggedbottom  

% PACKAGES FOR TITLES
\usepackage{titlesec}
% \titlespacing{\section}{left spacing}{before spacing}{after spacing}
\titlespacing{\section}{0pt}{3.3ex}{2ex}
\titlespacing{\subsection}{0pt}{3.3ex}{1.65ex}
\titlespacing{\subsubsection}{0pt}{3.3ex}{1ex}
\usepackage{color}

% PACKAGES FOR LANGUAGE AND FONT
\usepackage[english]{babel} % The document is in English  
\usepackage[utf8]{inputenc} % UTF8 encoding
\usepackage[T1]{fontenc} % Font encoding
\usepackage[11pt]{moresize} % Big fonts

% PACKAGES FOR IMAGES
\usepackage{graphicx}
\usepackage{transparent} % Enables transparent images
\usepackage{eso-pic} % For the background picture on the title page
\usepackage{subfig} % Numbered and caption subfigures using \subfloat.
\usepackage{tikz} % A package for high-quality hand-made figures.
\usetikzlibrary{}
\graphicspath{{./Images/}} % Directory of the images
\usepackage{caption} % Coloured captions
\usepackage{xcolor} % Coloured captions
\usepackage{amsthm,thmtools,xcolor} % Coloured "Theorem"
\usepackage{float}

% STANDARD MATH PACKAGES
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{bm}
\usepackage[overload]{empheq} % For braced-style systems of equations.
\usepackage{fix-cm} % To override original LaTeX restrictions on sizes

% PACKAGES FOR TABLES
\usepackage{tabularx}
\usepackage{longtable} % Tables that can span several pages
\usepackage{colortbl}

% PACKAGES FOR ALGORITHMS (PSEUDO-CODE)
\usepackage{algorithm}
\usepackage{algorithmic}

% PACKAGES FOR REFERENCES & BIBLIOGRAPHY
\usepackage[colorlinks=true,linkcolor=black,anchorcolor=black,citecolor=black,filecolor=black,menucolor=black,runcolor=black,urlcolor=black]{hyperref} % Adds clickable links at references
\usepackage{cleveref}
\usepackage[square, numbers, sort&compress]{natbib} % Square brackets, citing references with numbers, citations sorted by appearance in the text and compressed
\bibliographystyle{abbrvnat} % You may use a different style adapted to your field

% OTHER PACKAGES
\usepackage{pdfpages} % To include a pdf file
\usepackage{afterpage}
\usepackage{lipsum} % DUMMY PACKAGE
\usepackage{fancyhdr} % For the headers
\fancyhf{}

% Input of configuration file. Do not change config.tex file unless you really know what you are doing. 
\input{Configuration_Files/config}

%----------------------------------------------------------------------------
%	NEW COMMANDS DEFINED
%----------------------------------------------------------------------------

% EXAMPLES OF NEW COMMANDS
\newcommand{\bea}{\begin{eqnarray}} % Shortcut for equation arrays
\newcommand{\eea}{\end{eqnarray}}
\newcommand{\e}[1]{\times 10^{#1}}  % Powers of 10 notation

%----------------------------------------------------------------------------
%	ADD YOUR PACKAGES (be careful of package interaction)
%----------------------------------------------------------------------------
\usepackage{listings}
\usepackage{xcolor}
\usepackage{geometry}

\lstdefinelanguage{MongoDB}{
  morekeywords={db, aggregate, \$group, \$match, \_id, \$max, \$avg, \$sum, \$sort, \$limit, sort},
  sensitive=true,
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]'"
}

\lstset{
  language=MongoDB,
  basicstyle=\ttfamily,
  keywordstyle=\color{blue},
  commentstyle=\color{green!40!black},
  stringstyle=\color{black},
  stepnumber=1,
  numberstyle=\tiny\color{gray},
  breaklines=true,
  breakatwhitespace=true,
  tabsize=4
}

%----------------------------------------------------------------------------
%	ADD YOUR DEFINITIONS AND COMMANDS (be careful of existing commands)
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
%	BEGIN OF YOUR DOCUMENT
%----------------------------------------------------------------------------

\begin{document}

\fancypagestyle{plain}{%
\fancyhf{} % Clear all header and footer fields
\fancyhead[RO,RE]{\thepage} %RO=right odd, RE=right even
\renewcommand{\headrulewidth}{0pt}
\renewcommand{\footrulewidth}{0pt}}

%----------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------

\pagestyle{empty} % No page numbers
\frontmatter % Use roman page numbering style (i, ii, iii, iv...) for the preamble pages

\puttitle{
	title=Systems and Methods for Big and Unstructured Data Project,
	name1=Matteo Balice, % Author Name and Surname
	name2=Antonio Giuseppe Doronzo, 
	name3=Alessandro Masini 10940986, 
	name4=,
	name5=,
	academicyear=2023-2024,
	groupnumber=GroupNumber
} % These info will be put into your Title page 

%----------------------------------------------------------------------------
%	PREAMBLE PAGES: ABSTRACT (inglese e italiano), EXECUTIVE SUMMARY
%----------------------------------------------------------------------------
\startpreamble
\setcounter{page}{1} % Set page counter to 1

%----------------------------------------------------------------------------
%	LIST OF CONTENTS/FIGURES/TABLES/SYMBOLS
%----------------------------------------------------------------------------

% TABLE OF CONTENTS
\thispagestyle{empty}
\tableofcontents % Table of contents 
\thispagestyle{empty}
\cleardoublepage

%-------------------------------------------------------------------------
%	THESIS MAIN TEXT
%-------------------------------------------------------------------------
% In the main text of your thesis you can write the chapters in two different ways:
%
%(1) As presented in this template you can write:
%    \chapter{Title of the chapter}
%    *body of the chapter*
%
%(2) You can write your chapter in a separated .tex file and then include it in the main file with the following command:
%    \chapter{Title of the chapter}
%    \input{chapter_file.tex}
%
% Especially for long thesis, we recommend you the second option.

\addtocontents{toc}{\vspace{2em}} % Add a gap in the Contents, for aesthetics
\mainmatter % Begin numeric (1,2,3...) page numbering

\chapter{Chapter one}
\label{ch:chapter_one}%
% The \label{...}% enables to remove the small indentation that is generated, always leave the % symbol.

\section{Introduction}
Using the following dataset we'd like to tackle the problem of researching whether songs of the same genre also share specific values of the main features describing them (for example the energy or the danceability) and whether tracks with certain features are more likely to become popular than others\\
To face such task a documental database technology (more specifically MongoDB) has been chosen, since in this dataset the relationship between each object is quite often not relevant, and we care much more about the features of each single track, furthermore the granularity to which we'd like to operate is always the one of the single track, which therefore fit as a perfect business object for our day-to-day activity
\newpage

\section{Dataset}
This dataset provides comprehensive information about tracks available on the Spotify application, each document represent a single track that can be easily found by searching its name through Spotify search feature.\\
The data schema is:
\begin{table}[h!]
	\begin{center}
		\begin{tabular}{|m{12em}|m{4em}|m{25em}|}
		\hline
		\textbf{Attribute} & \textbf{Type} & \textbf{Description}\\
		\hline
			track\_id & String & The song unique ID\\
		\hline
			track\_name & String & The name of the track\\
		\hline
			track\_artist & String & The name of the artist that made the song\\
		\hline
			track\_popularity & Integer & The popularity score of the track on Spotify ranging from a minimum of 0 to a maximum of 100.\\
		\hline
			track\_album\_id & String & The unique ID of the album\\
		\hline
			track\_album\_name & String & The name of the album the track belongs to\\
		\hline
			track\_album\_release\_date & Date & The date in which the album was released\\
		\hline
			playlist\_name & String & The name of the playlist in which Spotify classified this song\\
		\hline
			playlist\_id & String & The ID of the playlist in which Spotify classified this song\\
		\hline
			playlist\_genre & String & The genre of the playlist in which Spotify classified this song\\
		\hline
			playlist\_subgenre & String & The subgenre of the playlist in which Spotify classified this song\\
		\hline
			danceability & Double & A score ranging from 0 to 1 that represents how suitable a track is for dancing based on various musical elements including tempo, rhythm stability, beat strength, and overall regularity.\\
		\hline
			energy & Double & A measure of the perceptual intensity and activity of a track, ranging from 0 to 1. Typically, energetic tracks feel fast, loud, and noisy. For example, death metal's tracks have high energy, while a Bach prelude scores low on this scale.\\
		\hline
			key & Integer & The estimated overall key of the track. Standard integer pitch notation is used, e.g. C = 0, C$\sharp$/D$\flat$ = 1, D = 2, and so on, while if no key was detected, a value of -1 is assigned\\
		\hline
		\end{tabular}
	\end{center}
\end{table}\newpage

\begin{table}[h!]
	\begin{center}
		\hspace*{-1cm}
		\begin{tabular}{|m{8em}|m{4em}|m{29em}|}
		\hline
		\textbf{Attribute} & \textbf{Type} & \textbf{Description}\\
		\hline
			loudness & Double & The overall loudness of a track in decibels (dB). Loudness values are averaged across the entire track and typically range between -60 and 0 db\\
		\hline
			mode & Integer & The tonal mode of the track, the type of scale from which its melodic content is derived, represented by an integer value (0 for minor, 1 for major).\\
		\hline
			speechiness & Double & A score ranging from 0 to 1 that represents the presence of spoken words in a track. The more exclusively speech-like the recording the closer to 1.0 the attribute value.\\
		\hline
			acousticness & Double & A score ranging from 0 to 1 that represents the confidence of a track being acoustic or similarly the extent to which a track possesses an acoustic quality. (1.0 represents very high confidence that the track is acoustic)\\
		\hline
			instrumentalness & Double & A score ranging from 0 to 1 that represents the likelihood of a track being instrumental (so having no vocals). The closer the instrumentalness value is to 1.0, the greater is the likelihood that the track contains no vocal content, values above 0.5 can be considered as instrumental tracks, but confidence is higher as the value approaches 1.0.\\
		\hline
			liveness & Double & A score ranging from 0 to 1 that represents the probability of the presence of an audience during the recording or performance of a track. A value above 0.8 provides a strong likelihood that the track has been performed live.\\
		\hline
			valence & Double & A score ranging from 0 to 1 that represents the musical positiveness conveyed by a track. Tracks with high valence sound more positive (happy, cheerful, euphoric), while tracks with low valence sound more negative (sad, depressed, angry).\\
		\hline
			tempo & Double & The overall estimated tempo of the track in beats per minute (BPM). Tempo is perceived as the speed or pace of a given track.\\
		\hline
			duration\_ms & Integer & The duration of the track in milliseconds.\\
		\hline
		\end{tabular}
		\hspace*{1cm}
	\end{center}
\end{table}
The source of the dataset is:\\
\url{https://www.kaggle.com/datasets/joebeachcapital/30000-spotify-songs}
\newpage
\section*{Queries}
\subsection{Preferred musical genre}
This query analyses the popularity of each musical genre, by calculating the average of the track\_popularity score for each one of them, in order to understand what musical genre are the user's favorites\\

\begin{algorithm}[ht]
\caption{Preferred musical genre}
\begin{lstlisting} [numbers = left]
db.spotify_music.aggregate([
	{"$group" : {
			"_id" : {"Music_genre" : "$playlist_genre"},
			"Popularity" : {"$avg" : "$track_popularity"},
			"Number_of_samples" : {"$sum" : 1}
	}}
]).sort({
	"Popularity" : -1
})
\end{lstlisting}
\end{algorithm}
\newpage

Output:
\begin{algorithm}[h!]
\caption{Output Preferred musical genre}
\begin{lstlisting} [numbers = left]
[
	{
		_id: { Music_genre: 'pop' },
		Popularity: 47.74487016524424,
		Number_of_samples: 5507
	},
	{
		_id: { Music_genre: 'latin' },
		Popularity: 47.026576139670226,
		Number_of_samples: 5155
	},
	{
		_id: { Music_genre: 'rap' },
		Popularity: 43.21545422902889,
		Number_of_samples: 5746
	},
	{
		_id: { Music_genre: 'rock' },
		Popularity: 41.72833770955363,
		Number_of_samples: 4951
	},
	{
		_id: { Music_genre: 'r&b' },
		Popularity: 41.22353157797827,
		Number_of_samples: 5431
	},
	{
		_id: { Music_genre: 'edm' },
		Popularity: 34.83352639417508,
		Number_of_samples: 6043
	}
]
\end{lstlisting}
\end{algorithm}
\newpage

\subsection{Most popular song for each genre}
This query explores which is the most popular song in each genre, by finding the song with the highest popularity score among each one of them (we have chosen to allow songs to be in more than one genre, if they have been classified as such)\\
\begin{algorithm}[ht]
\caption{Most popular song for each genre}
\begin{lstlisting} [numbers = left]
db.spotify_music.aggregate([
	{$group: {
		_id: "$playlist_genre",
		Most_Popular_Song: {
			$max: {
				Popularity: "$track_popularity",
				Title: "$track_name",
				Artist: "$track_artist"
			}
		}
	}},
	{"$sort" : {"_id" : 1}}
])
\end{lstlisting}
\end{algorithm}
\newpage

\newgeometry{top = 8 em}
\begin{algorithm}[ht]
\caption{Output: Most popular song for each genre}
\begin{lstlisting} [numbers = left]
[
	{
		_id: 'edm',
		Most_Popular_Song: {
			Popularity: 99,
			Title: 'ROXANNE',
			Artist: 'Arizona Zervas' 
		}
	},
	{
		_id: 'latin',
		Most_Popular_Song: {
			Popularity: 100,
			Title: 'Dance Monkey',
			Artist: 'Tones and I'
		}
	},
	{
		_id: 'pop',
		Most_Popular_Song: {
			Popularity: 100,
			Title: 'Dance Monkey',
			Artist: 'Tones and I' 
		}
	},
	{
		_id: 'r&b',
		Most_Popular_Song: {
			Popularity: 99,
			Title: 'ROXANNE',
			Artist: 'Arizona Zervas'
		}
	},
	{
		_id: 'rap',
		Most_Popular_Song: {
			Popularity: 98,
			Title: 'Tusa',
			Artist: 'KAROL G'
		}
	},
	{
		_id: 'rock',
		Most_Popular_Song: {
			Popularity: 95,
			Title: 'bad guy',
			Artist: 'Billie Eilish'
		}
	}
]
\end{lstlisting}
\end{algorithm}
\restoregeometry

\subsection{Loudest musical genre}
This query tries to understand which are the three loudest musical genre, by calculating the average loudness of each one of them and then showing the loudest three as output\\

\begin{algorithm}[ht]
\caption{Loudest musical genre}
\begin{lstlisting} [numbers = left]
	db.spotify_music.aggregate([
		{"$group" : {
			  "_id" : {"Music_genre" : "$playlist_genre"},
			  "Average_loudness" : {"$avg" : "$loudness"},
			  "Number_of_samples" : {"$sum" : 1}
		}},
  		{"$sort" : {"Average_loudness" : -1}},
    	{"$limit" : 3}
	])
\end{lstlisting}
\end{algorithm}
\newpage

Output:
\begin{algorithm}[ht]
\caption{Output: Loudest musical genre}
\begin{lstlisting} [numbers = left]
[
	{
		_id: { Music_genre: 'edm' },
		Average_loudness: -5.427445143140824,
		Number_of_samples: 6043
	},
	{
		_id: { Music_genre: 'latin' },
		Average_loudness: -6.264454704170708,
		Number_of_samples: 5155
	},
	{
		_id: { Music_genre: 'pop' },
		Average_loudness: -6.315328127837298,
		Number_of_samples: 5507
	}
]
\end{lstlisting}
\end{algorithm}
\newpage

\subsection{Most danceable musical genre}
This query explores which musical genre are the most danceable, by calculating the average danceability of each one of them\\
\begin{algorithm}[ht]
\caption{Most danceable musical genre}
\begin{lstlisting} [numbers = left]
db.spotify_music.aggregate([
	{"$group" : {
		"_id" : {"Music_genre" : "$playlist_genre"},
		"Average_danceability" : {"$avg" : "$danceability"},
		"Number_of_samples" : {"$sum" : 1}
	}},
  	{"$sort" : {"Average_danceability" : -1}}
])
\end{lstlisting}
\end{algorithm}
\newpage

Output:
\begin{algorithm}[ht]
\caption{Output: Most danceable musical genre}
\begin{lstlisting} [numbers = left]
[
	{
		_id: { Music_genre: 'rap' },
		Average_danceability: 0.7183527671423598,
		Number_of_samples: 5746
	},
	{
		_id: { Music_genre: 'latin' },
		Average_danceability: 0.7132872550921435,
		Number_of_samples: 5155
	},
	{
		_id: { Music_genre: 'r&b' },
		Average_danceability: 0.6701793408212116,
		Number_of_samples: 5431
	},
	{
		_id: { Music_genre: 'edm' },
		Average_danceability: 0.6550408737382095,
		Number_of_samples: 6043
	},
	{
		_id: { Music_genre: 'pop' },
		Average_danceability: 0.6393017069184674,
		Number_of_samples: 5507
	},
	{
		_id: { Music_genre: 'rock' },
		Average_danceability: 0.5205479701070491,
		Number_of_samples: 4951
	}
]
\end{lstlisting}
\end{algorithm}
\newpage
\subsection{Most popular artists}
This query analyses the popularity of each musical artist, by calculating the average between the track\_popularity score of each one of their songs for each artist, in order to understand which artists produce musical hits more consistently.\\
For this query, only artist that have produced at least two different songs have been considered
\begin{algorithm}[ht]
\caption{Most popular artists}
\begin{lstlisting} [numbers = left]
db.spotify_music.aggregate([
	{"$group" : {
			"_id" : "$track_name",
			"track_popularity" : {"$max" : "$track_popularity"},
			"track_artist" : {"$first" : "$track_artist"}
	}},
	{"$group" : {
		"_id" : "$track_artist",
		"Average_Song_Popularity" : {"$avg" : "$track_popularity"},
		"Number_of_Songs" : {"$sum" : 1}
	}},
	{"$match" : {"Number_of_Songs" : {"$gte" : 2}}},
	{"$sort" : {"Average_Song_Popularity" : -1}},
	{"$limit" : 7}
])
\end{lstlisting}
\end{algorithm}
\newpage

Output:
\begin{algorithm}[h!]
\caption{Output: Most popular artists}
\begin{lstlisting} [numbers = left]
[
	{
		_id: 'Don Toliver',
		Average_Song_Popularity: 87.5,
		Number_of_Songs: 2
	},
	{
		_id: 'Kina',
		Average_Song_Popularity: 85.5,
		Number_of_Songs: 2 
	},
	{
		_id: 'MEDUZA',
		Average_Song_Popularity: 85.33333333333333,
		Number_of_Songs: 3
	},
	{
		_id: 'Juice WRLD',
		Average_Song_Popularity: 85,
		Number_of_Songs: 9
	},
	{
		_id: 'JACKBOYS',
		Average_Song_Popularity: 84.33333333333333,
		Number_of_Songs: 3
	},
	{
		_id: 'Roddy Ricch',
		Average_Song_Popularity: 84,
		Number_of_Songs: 6
	},
	{
		_id: 'DaBaby',
		Average_Song_Popularity: 83.66666666666667,
		Number_of_Songs: 6
	}
]
\end{lstlisting}
\end{algorithm}

% LIST OF FIGURES
%\listoffigures

% LIST OF TABLES
%\listoftables

%\cleardoublepage

\end{document}
